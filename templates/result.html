<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Prediction Result</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            max-width: 900px; /* widened for landscape chart */
            width: 92%;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .header { margin-bottom: 2rem; }
        .header h1 { color: #333; margin-bottom: 0.5rem; font-size: 2.5rem; font-weight: 300; }
        
        .result-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
        }
        
        .result-error {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.3);
        }
        
        .temperature { font-size: 3rem; font-weight: bold; margin: 1rem 0; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .prediction-label { font-size: 1.2rem; margin-bottom: 0.5rem; opacity: 0.9; }
        .location-info { background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 10px; margin-top: 1rem; backdrop-filter: blur(5px); }
        .location-info h3 { margin: 0 0 0.5rem 0; font-size: 1.1rem; }
        .coordinates { font-family: 'Courier New', monospace; font-size: 0.9rem; opacity: 0.8; }
        .error-message { font-size: 1.1rem; line-height: 1.5; margin: 1rem 0; }
        .error-icon { font-size: 2rem; margin-bottom: 1rem; }
        
        .buttons { margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap; }
        .btn { flex: 1; min-width: 120px; padding: 1rem 1.5rem; border: none; border-radius: 10px; font-size: 1rem; font-weight: 500; cursor: pointer; text-decoration: none; display: inline-block; text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
        .btn:active { transform: translateY(0); }
        
        .success-icon { font-size: 2rem; margin-bottom: 1rem; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
        .timestamp { font-size: 0.9rem; color: #666; margin-top: 1rem; font-style: italic; }
        
        /* New: chart card for landscape look */
        .chart-card {
            background: #fff;
            border-radius: 12px;
            padding: 1rem 1rem 0.5rem 1rem;
            margin-top: 1rem;
            box-shadow: 0 4px 16px rgba(0,0,0,.06);
            width: 100%;
            height: 320px;
        }
        .chart-title { margin: 0 0 .75rem 0; color: #333; font-weight: 600; font-size: 1.05rem; text-align: left; }
        
        @media (max-width: 600px) {
            .container { margin: 1rem; padding: 1.25rem; }
            .header h1 { font-size: 2rem; }
            .temperature { font-size: 2.5rem; }
            .buttons { flex-direction: column; }
            .btn { min-width: auto; }
            .chart-card { height: 260px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå§Ô∏è Prediction Result</h1>
        </div>
        
        {% if prediction %}
            <div class="result-success">
                <div class="success-icon">üéØ</div>
                <div class="prediction-label">Next Hours Temperature</div>
                <div class="temperature">{{ prediction }}</div>
                
                <div class="location-info">
                    <h3>üìç Location</h3>
                    <div class="coordinates">
                        Latitude: {{ "%.6f"|format(latitude) }}<br>
                        Longitude: {{ "%.6f"|format(longitude) }}
                    </div>
                </div>
            </div>

            <!-- Improved landscape chart -->
            <div class="chart-card">
                <div class="chart-title">Last 10 Hours Temperature</div>
                <canvas id="historyChart" style="width: 100%; height: 100%;"></canvas>
            </div>
            
        {% elif error %}
            <div class="result-error">
                <div class="error-icon">‚ö†Ô∏è</div>
                <div class="error-message">{{ error }}</div>
            </div>
        {% endif %}
        
        <div class="buttons">
            <a href="/" class="btn btn-primary">üîÑ New Prediction</a>
            <button onclick="window.history.back()" class="btn btn-secondary">‚Üê Go Back</button>
        </div>
        
        {% if prediction %}
        <div style="background: #f8f9ff; border-radius: 10px; padding: 1rem; margin-top: 1.5rem; font-size: 0.9rem; color: #666;">
            <strong>Note:</strong> This prediction is generated by an LSTM neural network trained on historical weather data. Actual temperatures may vary due to unpredictable weather conditions.
        </div>
        {% endif %}
    </div>

    {% if prediction %}
    <!-- Embedded history data as JSON -->
    <script id="chart-data" type="application/json">{{ {'labels': chart_labels or [], 'values': chart_values or []} | tojson }}</script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        // Parse embedded JSON data
        let rawLabels = [], values = [];
        const el = document.getElementById('chart-data');
        if (el && el.textContent) {
            try {
                const parsed = JSON.parse(el.textContent);
                rawLabels = parsed.labels || [];
                values = parsed.values || [];
            } catch (e) { console.error('Failed to parse chart data', e); }
        }

        // Format labels as HH:MM (and day if changed) for landscape readability
        const displayLabels = rawLabels.map((l, i, arr) => {
            const d = new Date(l);
            const time = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            if (i > 0) {
                const prev = new Date(arr[i-1]);
                if (d.getDate() !== prev.getDate()) {
                    return d.toLocaleDateString([], { month: 'short', day: 'numeric' }) + ' ' + time;
                }
            }
            return time;
        });

        if (displayLabels.length && values.length) {
            const canvas = document.getElementById('historyChart');
            const ctx = canvas.getContext('2d');
            // Gradient fill for nicer look
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(102, 126, 234, 0.30)');
            gradient.addColorStop(1, 'rgba(102, 126, 234, 0.00)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: displayLabels,
                    datasets: [{
                        label: 'Temperature (¬∞C)',
                        data: values,
                        fill: true,
                        backgroundColor: gradient,
                        borderColor: 'rgba(76, 110, 245, 1)',
                        borderWidth: 3,
                        tension: 0.35,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        pointBackgroundColor: '#4c6ef5',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { autoSkip: true, maxTicksLimit: 10, maxRotation: 0 }
                        },
                        y: {
                            title: { display: true, text: '¬∞C' },
                            grid: { color: 'rgba(0,0,0,0.06)' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (items) => {
                                    const idx = items[0].dataIndex;
                                    const d = new Date(rawLabels[idx]);
                                    return d.toLocaleString();
                                },
                                label: (item) => `Temperature: ${item.parsed.y} ¬∞C`
                            }
                        }
                    }
                }
            });
        }
    </script>
    {% endif %}
</body>
</html>